<?php require('./header.php') ?>
<?php require('./bd.php') ?>
<!-- Begin Page Content -->
<style>
    /* Estilos CSS para el formulario */
    form {
        width: 400px;
        margin: 0 auto;
    }

    label {
        display: block;
        margin-bottom: 10px;
    }

    input[type="text"],
    select {
        width: 100%;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    input[type="submit"] {
        width: 100%;
        padding: 10px;
        background-color: #4CAF50;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    input[type="submit"]:hover {
        background-color: #45a049;
    }

    /* Estilos para la ventana modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<div class="container-fluid">


    <form method="POST" action="<?php echo $_SERVER["PHP_SELF"]; ?>" enctype="multipart/form-data">
        <label for="id_producto">Id Producto:</label>
        <input type="text" id="id_producto" name="id_producto" required>


        <label for="Nombre">Nombre:</label>
        <input type="text" id="Nombre" name="Nombre" required>

        <label for="descripcion">Descripción:</label>
        <textarea id="descripcion" name="descripcion" rows="2" cols="45" required></textarea>

        <label for="categoria">Categoría:</label>
        <select id="categoria" name="categoria" required>
            <option value="">Seleccionar</option>

            <?php $sql = "SELECT * FROM Categoria";

            $result = $conn->query($sql);

            if ($result->num_rows > 0) {
                while ($categoria = $result->fetch_assoc()) {
                    echo "<option value=\"" . $categoria['IdCategoria'] . "\">" . $categoria['Nombre'] . "</option>";
                }
            } ?>
        </select>



        <label for="coste">Precio unitario:</label>
        <input type="precio" id="coste" name="coste" required>

        <label for="iva">16% IVA: <input type="checkbox" id="iva" name="iva"></label>

        <label for="precio">Precio con 16% IVA:</label>
        <input type="precio" id="precio" name="precio" readonly>

        <label for="Imagen">Seleccionar Nueva Imagen:</label>
        <input type="file" name="Imagen" accept="image/*"><br><br>
        <input style="margin-top: 10px;" type="submit" value="Enviar">
    </form>


    <tbody>
        <?php
        if ($_SERVER["REQUEST_METHOD"] == "POST") {
            $idProducto = $_POST["id_producto"];
            $categoria = $_POST["categoria"];
            $Nombre = $_POST["Nombre"];
            $coste = $_POST["coste"];
            $precio = $_POST["precio"];
            $descripcion = $_POST["descripcion"];

            $insertQuery = "INSERT INTO producto (IdProducto, IdEstatus, IdCategoria, Coste, Precio, Nombre, Descripcion, Imagen)
            VALUES ('$idProducto', 1, '$categoria', '$coste', '$precio', '$Nombre', '$descripcion','1')";

            if ($conn->query($insertQuery) === TRUE) {
                echo "Registro insertado correctamente";
            } else {
                echo "Error al insertar el registro: " . $conn->error;
            }



            if (isset($_FILES["Imagen"]) && $_FILES["Imagen"]["error"] === UPLOAD_ERR_OK) {
                $nombreArchivo = $_FILES["Imagen"]["name"];
                $rutaTemporal = $_FILES["Imagen"]["tmp_name"];
                $rutaDestino = "C:/xampp/htdocs/T210/sweet/pagina/assets/imagenes_sweet/" . $nombreArchivo; // Ruta exacta

                // Obtener solo el nombre de archivo
                $nombreImagen = basename($rutaDestino);

                if (move_uploaded_file($rutaTemporal, $rutaDestino)) {
                    // Imagen subida correctamente, actualiza la base de datos con el nuevo nombre
                    $updateQuery = "UPDATE producto SET Imagen = '$nombreImagen' WHERE IdProducto = '$idProducto'";
                    if ($conn->query($updateQuery) === TRUE) {
                        echo "";
                    } else {
                        echo "Error al actualizar la imagen: " . $conn->error;
                    }
                } else {
                    echo "Error al mover el archivo.";
                }
            }

            if ($conn->query($sql) === TRUE) {
                echo "Registro insertado correctamente";
            } else {
                echo "" . $conn->error;
            }
        }

        ?>


        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const precioUnitarioInput = document.getElementById("coste");
                const ivaCheckbox = document.getElementById("iva");
                const precioConIvaInput = document.getElementById("precio");

                // Manejador de eventos para el cambio en el checkbox del IVA
                ivaCheckbox.addEventListener("change", function() {
                    if (ivaCheckbox.checked) {
                        // Calcular el precio con IVA
                        const precioUnitario = parseFloat(precioUnitarioInput.value);
                        const precioConIva = precioUnitario * 1.16; // 16% IVA
                        precioConIvaInput.value = precioConIva.toFixed(2); // Mostrar 2 decimales
                    } else {
                        precioConIvaInput.value = ""; // Limpiar el campo si el IVA no está seleccionado
                    }
                });
            });
        </script>


    </tbody>


</div>




</div>
<!-- End of Main Content -->

<?php require('./footer.php') ?>